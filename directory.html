<html>
  <script>
    function downloadDirectory(access_token) {
      // figure out the correct API call for people.
      // information needed:
      // * Name
      // * Picture
      // * Address
      // * Email
      // * Phone number
      const directory = document.getElementById('directory-body');

      directory.innerHTML = 'Directory info will go here';
    }

    function startHere() {

      const authInfo = window.localStorage.getItem('directoryAuthInfo');
      const authRedirectUrl = "https://api.planningcenteronline.com/oauth/authorize?client_id=1c60b5f9c9c37feedbbfe34ac0014b2b4f17ebfb71cd44bc6b702fd1ecec9d9f&redirect_uri=https://leadiv.github.io/directory-poc/auth-complete&response_type=code&scope=people";
      if (authInfo) {

        const { access_token, expires_in, created_at } = JSON.parse(authInfo);

        if (((created_at + expires_in - 300) * 1000) > Date.now()) {

          // we can make requests
          downloadDirectory(access_token);
        } else {

          window.location.href = authRedirectUrl;
        }
      } else {

        window.location.href = authRedirectUrl;
      }
    }

    document.addEventListener("DOMContentLoaded", (event) => {
      startHere();
    });
  </script>
  <body>
    <h1>The directory</h1>
    <section id="directory-body"></section>
  </body>
</html>
